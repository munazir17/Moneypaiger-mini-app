<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MoneyPaiger Mini App</title>

<meta property="fc:frame" content="vNext">
<meta property="fc:miniapp:domain" content="moneypaiger-mini-app-4vo8.vercel.app">
<meta property="fc:frame:image" content="https://moneypaiger-mini-app-4vo8.vercel.app/images/nft1.png">
<meta property="og:title" content="MoneyPaiger Mini App">
<meta property="og:description" content="Timeline of Digital Finance - Mint exclusive NFTs">

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#0a0a0a 0%,#1a1a2e 100%);color:#fff;min-height:100vh;padding:20px;}
.container{max-width:1200px;margin:0 auto;}
header{text-align:center;padding:40px 0;border-bottom:2px solid rgba(255,255,255,0.1);margin-bottom:20px;}
h1{font-size:3em;font-weight:900;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px;}
.tagline{font-size:1.2em;color:#a0a0a0;margin-bottom:10px;}
.creator-info{font-size:0.9em;color:#888;margin-top:10px;}
.creator-info a{color:#667eea;text-decoration:none;transition:color 0.3s;}
.creator-info a:hover{color:#764ba2;}
#connectBtn{margin-bottom:20px;padding:15px 25px;font-size:1em;font-weight:700;border:none;border-radius:10px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;cursor:pointer;transition: transform 0.2s;}
#connectBtn:hover{transform:scale(1.05);}
#connectBtn:disabled{background:#333;cursor:default;}
.supply-counter{font-size:1.1em;color:#22c55e;margin-bottom:30px;text-align:center;}
.nft-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:30px;}
.nft-card{background:rgba(255,255,255,0.05);border-radius:20px;overflow:hidden;transition:transform 0.3s, box-shadow 0.3s;border:1px solid rgba(255,255,255,0.1);}
.nft-card:hover{transform:translateY(-10px);box-shadow:0 20px 40px rgba(102,126,234,0.3);}
.nft-image{width:100%;height:300px;object-fit:cover;background:#000;}
.nft-info{padding:20px;}
.nft-title{font-size:1.5em;font-weight:700;margin-bottom:10px;color:#fff;}
.nft-description{font-size:0.95em;color:#a0a0a0;margin-bottom:15px;line-height:1.6;}
.mint-price{font-size:1.3em;font-weight:700;color:#22c55e;margin-bottom:15px;text-align:center;}
.mint-button{width:100%;padding:15px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border:none;border-radius:10px;color:white;font-size:1.1em;font-weight:700;cursor:pointer;transition:transform 0.2s, box-shadow 0.2s;}
.mint-button:hover{transform:scale(1.05);box-shadow:0 10px 25px rgba(102,126,234,0.4);}
.mint-button:active{transform:scale(0.98);}
.mint-button:disabled{background:#555;cursor:not-allowed;opacity:0.6;}
.status{margin-top:10px;padding:10px;border-radius:8px;text-align:center;font-size:0.9em;display:none;}
.status.success{background:rgba(34,197,94,0.2);color:#22c55e;display:block;}
.status.error{background:rgba(239,68,68,0.2);color:#ef4444;display:block;}
.status.info{background:rgba(59,130,246,0.2);color:#3b82f6;display:block;}
footer{text-align:center;margin-top:60px;padding:30px 0;border-top:2px solid rgba(255,255,255,0.1);color:#888;}
.social-links{margin-top:15px;}
.social-links a{color:#667eea;text-decoration:none;margin:0 10px;transition:color 0.3s;}
.social-links a:hover{color:#764ba2;}
@media(max-width:768px){h1{font-size:2em;}.nft-grid{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div class="container">
<header>
<h1>MONEYPAIGER</h1>
<p class="tagline">Timeline of Digital Finance - Since 2017</p>
<p class="creator-info">Built by <a href="https://farcaster.xyz/munazir" target="_blank">@munazir</a> on Farcaster</p>
<button id="connectBtn">Connect Wallet</button>
<div class="supply-counter" id="supply-counter">Loading supply...</div>
</header>

<main>
<div class="nft-grid" id="nft-grid"></div>
</main>

<footer>
<p>&copy; 2025 MoneyPaiger. All rights reserved.</p>
<div class="social-links">
<a href="https://farcaster.xyz/munazir" target="_blank">Farcaster</a>
</div>
</footer>
</div>

<script>
const contractAddress = "0xc591233c0a42b1ee3d412ae448db3208fbf09b83";
const abi = [
  "function mint(uint256 _mintAmount) public payable",
  "function totalSupply() public view returns (uint256)",
  "function maxSupply() public view returns (uint256)"
];

let provider, signer, contract;
let userAddress = null;

// ✅ All 6 NFTs included
const nftData = [
  {id:1, title:"Digital Finance Genesis", desc:"Commemorating the foundations of MoneyPaiger ecosystem.", img:"https://moneypaiger-mini-app-4vo8.vercel.app/images/nft1.png"},
  {id:2, title:"MP Rising", desc:"The iconic MP logo representing growth and innovation.", img:"https://moneypaiger-mini-app-4vo8.vercel.app/images/nft2.png"},
  {id:3, title:"MoneyPaiger Icon", desc:"Sleek MP icon badge representing financial growth.", img:"https://moneypaiger-mini-app-4vo8.vercel.app/images/nft3.png"},
  {id:4, title:"MoneyPaiger Brand", desc:"Full branding experience. Professional design meets excellence.", img:"https://moneypaiger-mini-app-4vo8.vercel.app/images/nft4.png"},
  {id:5, title:"MP Neon Logo", desc:"Neon styled logo highlighting digital innovation.", img:"https://moneypaiger-mini-app-4vo8.vercel.app/images/nft5.png"},
  {id:6, title:"MP Ultimate", desc:"Limited edition NFT celebrating MoneyPaiger milestones.", img:"https://moneypaiger-mini-app-4vo8.vercel.app/images/nft6.png"}
];

const grid = document.getElementById("nft-grid");
nftData.forEach(nft=>{
  const card = document.createElement("div");
  card.className="nft-card";
  card.innerHTML = `
    <img src="${nft.img}" class="nft-image" alt="${nft.title}">
    <div class="nft-info">
      <h3 class="nft-title">${nft.title}</h3>
      <p class="nft-description">${nft.desc}</p>
      <div class="mint-price">FREE MINT</div>
      <button class="mint-button" onclick="mintNFT(1,'status-${nft.id}')">Mint NFT</button>
      <div class="status" id="status-${nft.id}"></div>
    </div>
  `;
  grid.appendChild(card);
});

const baseNetwork = {
  chainId: '0x2105',
  chainName: 'Base Mainnet',
  nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
  rpcUrls: ['https://mainnet.base.org'],
  blockExplorerUrls: ['https://basescan.org']
};

async function checkNetwork() {
  if (!window.ethereum) return false;
  const currentChain = await window.ethereum.request({ method: 'eth_chainId' });
  if (currentChain !== baseNetwork.chainId) {
    try {
      await window.ethereum.request({
        method: 'wallet_switchEthereumChain',
        params: [{ chainId: baseNetwork.chainId }],
      });
      return true;
    } catch (err) {
      if (err.code === 4902) {
        try {
          await window.ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [baseNetwork],
          });
          return true;
        } catch (addError) {
          console.error('Failed to add Base network:', addError);
          return false;
        }
      }
      console.error('Failed to switch network:', err);
      return false;
    }
  }
  return true;
}

async function connectWallet() {
  const btn = document.getElementById('connectBtn');
  
  if (!window.ethereum) {
    alert('Please install MetaMask or another Web3 wallet!');
    return;
  }

  try {
    btn.textContent = 'Connecting...';
    btn.disabled = true;

    const accounts = await window.ethereum.request({ 
      method: 'eth_requestAccounts' 
    });
    
    userAddress = accounts[0];
    
    const networkOk = await checkNetwork();
    if (!networkOk) {
      throw new Error('Please switch to Base network');
    }

    provider = new ethers.providers.Web3Provider(window.ethereum);
    signer = provider.getSigner();
    contract = new ethers.Contract(contractAddress, abi, signer);

    btn.textContent = `Connected: ${userAddress.slice(0,6)}...${userAddress.slice(-4)}`;
    
    await updateSupply();
    
  } catch (error) {
    console.error('Connection error:', error);
    btn.textContent = 'Connect Wallet';
    btn.disabled = false;
    alert('Failed to connect wallet: ' + error.message);
  }
}

async function updateSupply() {
  try {
    if (!contract) {
      const baseNetworkConfig = { name: 'base', chainId: 8453 };
      const tempProvider = new ethers.providers.JsonRpcProvider('https://mainnet.base.org', baseNetworkConfig);
      const tempContract = new ethers.Contract(contractAddress, abi, tempProvider);
      const total = await tempContract.totalSupply();
      const max = await tempContract.maxSupply();
      document.getElementById('supply-counter').textContent = `Minted: ${total.toString()} / ${max.toString()}`;
    } else {
      const total = await contract.totalSupply();
      const max = await contract.maxSupply();
      document.getElementById('supply-counter').textContent = `Minted: ${total.toString()} / ${max.toString()}`;
    }
  } catch (error) {
    console.error('Supply fetch error:', error);
    document.getElementById('supply-counter').textContent = 'Supply: Check wallet connection';
  }
}

async function mintNFT(amount, statusId) {
  const statusEl = document.getElementById(statusId);
  const btn = statusEl.previousElementSibling;
  
  if (!contract || !signer) {
    statusEl.className = 'status error';
    statusEl.textContent = 'Please connect your wallet first!';
    return;
  }

  try {
    btn.disabled = true;
    btn.textContent = 'Minting...';
    statusEl.className = 'status info';
    statusEl.textContent = 'Confirm transaction in your wallet...';

    const tx = await contract.mint(amount);
    statusEl.textContent = 'Transaction submitted! Waiting for confirmation...';
    await tx.wait();
    statusEl.className = 'status success';
    statusEl.textContent = '✅ NFT Minted Successfully!';
    await updateSupply();
    
    setTimeout(() => {
      btn.disabled = false;
      btn.textContent = 'Mint NFT';
    }, 3000);

  } catch (error) {
    console.error('Mint error:', error);
    statusEl.className = 'status error';
    if (error.code === 4001) {
      statusEl.textContent = 'Transaction rejected by user';
    } else if (error.message.includes('insufficient funds')) {
      statusEl.textContent = 'Insufficient ETH for gas fees';
    } else {
      statusEl.textContent = 'Mint failed: ' + (error.reason || error.message);
    }
    btn.disabled = false;
    btn.textContent = 'Mint NFT';
  }
}

// Connect wallet button
document.getElementById('connectBtn').addEventListener('click', connectWallet);

// Auto-connect on page load
window.addEventListener('load', async () => {
  if (window.ethereum) {
    try {
      const accounts = await window.ethereum.request({ method: 'eth_accounts' });
      if (accounts.length > 0) await connectWallet();
      else await updateSupply();
    } catch (error) {
      console.error('Auto-connect failed:', error);
      await updateSupply();
    }
  } else {
    await updateSupply();
  }
});

// Listen for account/network changes
if (window.ethereum) {
  window.ethereum.on('accountsChanged', (accounts) => {
    if (accounts.length === 0) {
      document.getElementById('connectBtn').textContent = 'Connect Wallet';
      document.getElementById('connectBtn').disabled = false;
      userAddress = null;
      contract = null;
      signer = null;
    } else connectWallet();
  });

  window.ethereum.on('chainChanged', () => window.location.reload());
}
</script>
</body>
</html>
